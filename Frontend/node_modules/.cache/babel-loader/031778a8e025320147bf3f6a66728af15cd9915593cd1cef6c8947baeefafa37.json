{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{getMessages,addMessage}from'../actions/chatActions';import{format}from\"timeago.js\";import{getUserDetails}from'../actions/auth';import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Chatbox(_ref){let{chat,loggedInUser,setSendMessage,receivedMessage}=_ref;const[reciverDetails,setReciverDetails]=useState();const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState(\"\");const scroll=useRef();useEffect(()=>{if(chat){const userId=chat.members.find(id=>id!=loggedInUser);fetchUserDetails(userId);}},[chat]);const fetchUserDetails=async id=>{const data=await getUserDetails(id);setReciverDetails(data);};useEffect(()=>{const fetchMessages=async()=>{try{const data=await getMessages(chat._id);setMessages(data);}catch(error){console.log(error);}};if(chat!==null)fetchMessages();},[chat]);const handleChange=e=>{setNewMessage(e.target.value);};const handleClick=async e=>{e.preventDefault();// Check if newMessage is empty\nif(!newMessage.trim()){return;}const textMessage={senderId:loggedInUser,text:newMessage,chatId:chat._id};const receiverId=chat.members.find(id=>id!==loggedInUser);setSendMessage({...textMessage,receiverId});try{const data=await addMessage(textMessage);setMessages([...messages,data]);setNewMessage(\"\");}catch{console.log(\"error\");}};useEffect(()=>{if(receivedMessage!=null&&receivedMessage.chatId===chat._id){setMessages([...messages,receivedMessage]);}},[receivedMessage]);useEffect(()=>{var _scroll$current;(_scroll$current=scroll.current)===null||_scroll$current===void 0?void 0:_scroll$current.scrollIntoView({behavior:\"smooth\"});},[messages]);return/*#__PURE__*/_jsx(_Fragment,{children:chat?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col flex-auto h-full p-1 lg:sticky top-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-4 mb-2 sticky top-0 z-10 flex items-center justify-between\",children:!reciverDetails?/*#__PURE__*/_jsx(_Fragment,{}):/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-8 w-8 bg-indigo-200 rounded-full\",children:reciverDetails.name.charAt(0)}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-4\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"text-lg font-semibold inline\",children:reciverDetails.name})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"max-w-full mx-auto h-full flex flex-col justify-between\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 flex flex-col space-y-2 shadow-md p-4 rounded-lg bg-white overflow-y-auto\",children:messages.length>0&&messages.map((message,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"col-start-6 col-end-13 p-3 rounded-lg \".concat(message.senderId===loggedInUser?'flex-row-reverse':'flex-row'),children:message.senderId===loggedInUser?/*#__PURE__*/ // Receiver message\n_jsxs(\"div\",{className:\"flex flex-col items-end\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600\",children:\"You\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-end justify-end\",children:/*#__PURE__*/_jsx(\"div\",{ref:scroll,className:\"bg-gray-300 text-gray-700 p-2 rounded-lg max-w-xs\",children:message.text})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-600 self-end mt-1\",children:format(message.createdAt)})]}):/*#__PURE__*/ // Sender message\n_jsxs(\"div\",{className:\"flex flex-col items-start\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600\",children:\"Sender\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-end\",children:/*#__PURE__*/_jsx(\"div\",{ref:scroll,className:\"bg-blue-500 text-white p-2 rounded-lg max-w-xs\",children:message.text})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-600 self-start mt-1\",children:format(message.createdAt)})]})},index))})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-4 flex-shrink-0 sticky bottom-0 z-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type a message...\",className:\"flex-1 border rounded-full p-2 mr-2\",onChange:handleChange,value:newMessage}),/*#__PURE__*/_jsx(\"button\",{className:\"bg-blue-500 text-white p-2 rounded-full\",onClick:handleClick,children:\"Send\"})]})})]})]})}):/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-screen \",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Tap on chat to start the conversation.\"})})})});}","map":{"version":3,"names":["React","useState","useEffect","useRef","getMessages","addMessage","format","getUserDetails","Fragment","_Fragment","jsx","_jsx","jsxs","_jsxs","Chatbox","_ref","chat","loggedInUser","setSendMessage","receivedMessage","reciverDetails","setReciverDetails","messages","setMessages","newMessage","setNewMessage","scroll","userId","members","find","id","fetchUserDetails","data","fetchMessages","_id","error","console","log","handleChange","e","target","value","handleClick","preventDefault","trim","textMessage","senderId","text","chatId","receiverId","_scroll$current","current","scrollIntoView","behavior","children","className","name","charAt","length","map","message","index","concat","ref","createdAt","type","placeholder","onChange","onClick"],"sources":["/Users/rohit/Desktop/lost/Frontend/src/components/ChatBox.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { getMessages, addMessage } from '../actions/chatActions';\nimport { format } from \"timeago.js\";\nimport { getUserDetails } from '../actions/auth';\n\nexport default function Chatbox({ chat, loggedInUser, setSendMessage, receivedMessage }) {\n  const [reciverDetails, setReciverDetails] = useState();\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const scroll = useRef();\n\n  useEffect(() => {\n    if (chat) {\n      const userId = chat.members.find((id) => id != loggedInUser);\n      fetchUserDetails(userId);\n    }\n  }, [chat]);\n\n  const fetchUserDetails = async (id) => {\n    const data = await getUserDetails(id);\n    setReciverDetails(data);\n  };\n\n  useEffect(() => {\n    const fetchMessages = async () => {\n      try {\n        const data = await getMessages(chat._id);\n        setMessages(data);\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    if (chat !== null) fetchMessages();\n  }, [chat]);\n\n  const handleChange = (e) => {\n    setNewMessage(e.target.value);\n  };\n\n  const handleClick = async (e) => {\n    e.preventDefault();\n    \n    // Check if newMessage is empty\n    if (!newMessage.trim()) {\n      return;\n    }\n\n    const textMessage = {\n      senderId: loggedInUser,\n      text: newMessage,\n      chatId: chat._id,\n    };\n\n    const receiverId = chat.members.find((id) => id !== loggedInUser);\n\n    setSendMessage({ ...textMessage, receiverId });\n\n    try {\n      const data = await addMessage(textMessage);\n      setMessages([...messages, data]);\n      setNewMessage(\"\");\n    } catch {\n      console.log(\"error\");\n    }\n  };\n\n  useEffect(() => {\n    if (receivedMessage != null && receivedMessage.chatId === chat._id) {\n      setMessages([...messages, receivedMessage]);\n    }\n  }, [receivedMessage]);\n\n  useEffect(() => {\n    scroll.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  return (\n    <>\n      {chat ? (\n        <>\n          <div className=\"flex flex-col flex-auto h-full p-1 lg:sticky top-0\">\n            {/* Chat Header */}\n            <div className=\"bg-white p-4 mb-2 sticky top-0 z-10 flex items-center justify-between\">\n              {!reciverDetails ? (\n                <></>\n              ) : (\n                <div className=\"flex items-center\">\n                  <div className=\"flex items-center justify-center h-8 w-8 bg-indigo-200 rounded-full\">\n                    {reciverDetails.name.charAt(0)}\n                  </div>\n                  <div className=\"ml-4\">\n                    <h1 className=\"text-lg font-semibold inline\">{reciverDetails.name}</h1>\n                  </div>\n                </div>\n              )}\n            </div>\n            <div className=\"flex-1 overflow-y-auto\">\n              {/* Chat messages */}\n              <div className=\"max-w-full mx-auto h-full flex flex-col justify-between\">\n                {/* Messages container */}\n                <div className=\"flex-1 flex flex-col space-y-2 shadow-md p-4 rounded-lg bg-white overflow-y-auto\">\n                  {/* Render messages */}\n                  {messages.length > 0 &&\n                    messages.map((message, index) => (\n                      <div\n                        key={index}\n                        className={`col-start-6 col-end-13 p-3 rounded-lg ${\n                          message.senderId === loggedInUser ? 'flex-row-reverse' : 'flex-row'\n                        }`}\n                      >\n                        {message.senderId === loggedInUser ? (\n                          // Receiver message\n                          <div className=\"flex flex-col items-end\">\n                            <span className=\"text-sm text-gray-600\">You</span>\n                            <div className=\"flex items-end justify-end\">\n                              <div ref={scroll} className=\"bg-gray-300 text-gray-700 p-2 rounded-lg max-w-xs\">\n                                {message.text}\n                              </div>\n                            </div>\n                            <div className=\"text-xs text-gray-600 self-end mt-1\">{format(message.createdAt)}</div>\n                          </div>\n                        ) : (\n                          // Sender message\n                          <div className=\"flex flex-col items-start\">\n                            <span className=\"text-sm text-gray-600\">Sender</span>\n                            <div className=\"flex items-end\">\n                              <div ref={scroll} className=\"bg-blue-500 text-white p-2 rounded-lg max-w-xs\">\n                                {message.text}\n                              </div>\n                            </div>\n                            <div className=\"text-xs text-gray-600 self-start mt-1\">{format(message.createdAt)}</div>\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                </div>\n              </div>\n              {/* Chat input */}\n              <div className=\"bg-white p-4 flex-shrink-0 sticky bottom-0 z-10\">\n                <div className=\"flex\">\n                  <input\n                    type=\"text\"\n                    placeholder=\"Type a message...\"\n                    className=\"flex-1 border rounded-full p-2 mr-2\"\n                    onChange={handleChange}\n                    value={newMessage}\n                  />\n                  <button className=\"bg-blue-500 text-white p-2 rounded-full\" onClick={handleClick}>\n                    Send\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </>\n      ) : (\n        <div className=\"flex justify-center items-center h-screen \">\n          <p className=\"text-2xl\">\n            <span className=\"text-gray-500\">Tap on chat to start the conversation.</span>\n          </p>\n        </div>\n      )}\n    </>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}